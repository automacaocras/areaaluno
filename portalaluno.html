<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
Â  <title>Portal do Aluno â€“ Editora CrÃ¡s</title>
Â  <meta name="description" content="Acompanhe o prÃ³ximo feedback, envie exercÃ­cios e acesse conteÃºdos gravados.">
Â  <link rel="icon" type="image/png" href="assets/favicon.png" sizes="32x32">
Â  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png" sizes="180x180">
Â  <link rel="shortcut icon" href="assets/favicon.ico">
Â  <meta name="theme-color" content="#0286ff">
Â  <link rel="stylesheet" href="style.css?v=7">

Â  <style>
Â  Â  .topbar{
Â  Â  Â  width:100vw;margin-left:calc(50% - 50vw);margin-right:calc(50% - 50vw);
Â  Â  Â  background:#e6b200;color:#000;font-weight:800;text-align:center;
Â  Â  Â  padding:12px 0;box-shadow:inset 0 -2px 0 rgba(0,0,0,.08);
Â  Â  }
Â  Â  .curso-logo{width:200px;max-width:60vw;height:auto;display:block;margin:10px auto 6px}
Â  Â  .dias-restantes{font-weight:800;margin:8px 0 6px;text-align:center}
Â  Â  .dias-danger{color:#d93025}

Â  Â  .card,.box-feedback{
Â  Â  Â  max-width:900px;margin:14px auto;background:#fff;border:1px solid #f2e3a6;
Â  Â  Â  border-radius:18px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.06);text-align:center;
Â  Â  }

Â  Â  label{display:block;text-align:left;font-weight:700;margin-top:10px;margin-bottom:4px}
Â  Â  select,textarea,input[type="file"]{width:100%;max-width:100%;box-sizing:border-box}
Â  Â  textarea{min-height:120px;border-radius:10px;border:1px solid #ccc;padding:10px}

Â  Â  .btn-cta{
Â  Â  Â  display:block;width:100%;max-width:900px;margin:16px auto 10px;padding:16px 18px;
Â  Â  Â  border:none;border-radius:18px;background:#e6b200;color:#111;font-weight:800;cursor:pointer;
Â  Â  }
Â  Â  .flex-row{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
Â  Â  .btn-sec{background:#ddd;color:#111;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
Â  Â  .btn-exit{display:inline-block;margin:8px auto 24px;padding:10px 18px;background:#e53935;color:#fff;border:none;border-radius:12px;font-weight:800;cursor:pointer}
Â  Â  .btn-back{background:#ddd;color:#111;border:none;border-radius:12px;padding:10px 18px;font-weight:800;cursor:pointer}
Â  Â  .hidden{display:none!important}

Â  Â  #overlay{
Â  Â  Â  display:none;position:fixed;inset:0;width:100svw;height:100svh;background:rgba(0,0,0,.35);
Â  Â  Â  z-index:10000;place-items:center;
Â  Â  }
Â  Â  #overlay .loader{padding:12px 16px;background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.15);}
Â  Â  #overlay .loader-text{font-weight:700;color:#000;}
Â  Â  #filesWrap input[type="file"]{display:block;margin:6px auto;}

Â  Â  /* ===== Selects modernos ===== */
Â  Â  select {
Â  Â  Â  appearance: none;
Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  -moz-appearance: none;
Â  Â  Â  background: #fff url('data:image/svg+xml;utf8,<svg fill="%23000" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><polygon points="5,8 10,13 15,8"/></svg>') no-repeat right 12px center;
Â  Â  Â  background-size: 12px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 10px;
Â  Â  Â  padding: 10px 36px 10px 12px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #222;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: border-color .2s;
Â  Â  }
Â  Â  select:hover { border-color: #999; }
Â  Â  select:disabled { background-color: #f8f8f8; color: #888; }
    
    /* NOVO: CSS do Snackbar */
    #snackbar {
        visibility: hidden; 
        min-width: 250px; 
        margin-left: -125px;
        background-color: #333; 
        color: #fff; 
        text-align: center; 
        border-radius: 8px; 
        padding: 16px; 
        position: fixed; 
        z-index: 10000; 
        left: 50%; 
        bottom: 30px; 
        font-size: 17px; 
        box-shadow: 0 6px 20px rgba(0,0,0,.2);
    }
    #snackbar.show {
        visibility: visible; 
        -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
        animation: fadein 0.5s, fadeout 0.5s 2.5s;
    }
    @-webkit-keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @-webkit-keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
Â  </style>
</head>
<body>
Â  <div class="topbar">[aluno]</div>

Â  <main class="page-center" style="--center-offset:-40px;">
Â  Â  <img id="cursoLogo" class="curso-logo" alt="Curso" style="display:none">
Â  Â  <div id="diasRestantes" class="dias-restantes">Carregando...</div>

Â  Â  Â  Â  <div id="cupomBox" class="card" style="display:none">
Â  Â  Â  <div>Poxa, seu acesso ao curso estÃ¡ acabando ðŸ˜¢</div>
Â  Â  Â  <div style="margin-top:6px">
Â  Â  Â  Â  Use o cupom <span id="cupomCod" style="background:#111;color:#ffd400;padding:3px 8px;border-radius:6px;font-weight:800">---</span>
Â  Â  Â  Â  e receba <strong id="cupomPerc">---</strong>% de desconto para adquirir novamente.
Â  Â  Â  Â  <a id="cupomLink" href="#" target="_blank" rel="noopener">Clique aqui</a>.
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <section id="dashboard">
Â  Â  Â  <div class="box-feedback">
Â  Â  Â  Â  <h3>PrÃ³ximo feedback:</h3>
Â  Â  Â  Â  <p><strong id="fbDiaTxt" style="display:none"></strong><strong id="fbHoraTxt" style="display:none"></strong></p>
Â  Â  Â  Â  <p>Professor: <strong id="fbProf">â€”</strong></p>
Â  Â  Â  Â  <p><a id="fbLink" href="#" target="_blank" rel="noopener">[link da aula]</a></p>
Â  Â  Â  Â  <p>Senha: <strong id="fbSenha">â€”</strong></p>
Â  Â  Â  Â  <p id="fbInfo" style="margin-top:10px;color:#333">â€”</p>
Â  Â  Â  </div>

Â  Â  Â  <button id="btnAbrirEnvio" class="btn-cta" type="button">Envie os exercÃ­cios para feedback</button>

Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h3>Ãšltima aula gravada:</h3>
Â  Â  Â  Â  <p class="hint">Aproveite para baixar pois ela expira.</p>
Â  Â  Â  Â  <p><a id="ultimaGravada" href="#" target="_blank" rel="noopener">[link]</a></p>
Â  Â  Â  </div>

Â  Â  Â <div class="links-uteis" style="text-align:center; margin-top:25px;">
Â  <strong>Links Ãºteis:</strong><br>
Â  <a href="https://chat.whatsapp.com/JCnc5OfSkXVJyKB5uDQk81?mode=wwt"
Â  Â  Â target="_blank"
Â  Â  Â rel="noopener noreferrer"
Â  Â  Â style="display:inline-block; margin-top:8px; color:#075e54; font-weight:600; text-decoration:none;">
Â  Â  ðŸ’¬ Grupo dos alunos no WhatsApp
Â  </a>
</div>

Â  Â  Â Â 

Â  Â  Â Â 
Â  Â  Â  <div style="text-align:center"><button id="btnSair" class="btn-exit" type="button">Sair</button></div>
Â  Â  </section>

Â  Â  Â  Â  <section id="envio" class="hidden">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h2>Envio de exercÃ­cio para feedback</h2>
Â  Â  Â  Â  <div class="hint">*No mÃ¡ximo 3 artes por semana.</div>

Â  Â  Â  Â  <label>MÃ³dulo:</label>
Â  Â  Â  Â  <select id="selModulo" disabled><option>Carregando...</option></select>

Â  Â  Â  Â  <label>Aula:</label>
Â  Â  Â  Â  <select id="selAula" disabled><option>Selecione o mÃ³dulo primeiro</option></select>

Â  Â  Â  Â  <label>Envie a arte:</label>
Â  Â  Â  Â  <div id="filesWrap" class="row">
Â  Â  Â  Â  Â  <input type="file" class="fileItem" accept="image/*">
Â  Â  Â  Â  Â  <div class="thumb-hint">Formatos JPG/PNG. AtÃ© 3 envios.</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="flex-row">
Â  Â  Â  Â  Â  <button id="btnAddImagem" class="btn-sec" type="button">Adicionar imagem</button>
Â  Â  Â  Â  Â  <button id="btnResetar" class="btn-sec" type="button">Cancelar imagens</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <label>DescriÃ§Ã£o</label>
Â  Â  Â  Â  <textarea id="descricao" rows="5" placeholder="Conte sobre suas dificuldades."></textarea>

Â  Â  Â  Â  <button id="btnEnviar" class="btn-cta" type="button">Enviar</button>
Â  Â  Â  </div>

Â  Â  Â  <div class="envio-back" style="text-align:center;margin-top:10px;">
Â  Â  Â  Â  <button id="btnVoltarEnvio" class="btn-back" type="button">Voltar</button>
Â  Â  Â  </div>
Â  Â  </section>

Â  Â  Â  Â  <section id="sucesso" class="hidden">
Â  Â  Â  <div class="card">
Â  Â  Â  Â  <h2>âœ… Enviado!</h2>
Â  Â  Â  Â  <p>Seu desenho serÃ¡ avaliado em breve.</p>
Â  Â  Â  Â  <button id="btnVoltarMenu" class="btn-sec" type="button">Menu</button>
Â  Â  Â  </div>
Â  Â  </section>
Â  </main>

Â  <div id="overlay"><div class="loader"><div class="loader-text">Enviandoâ€¦</div></div></div>

  Â  <div id="snackbar"></div>

Â  <footer class="site-footer">
Â  Â  <div class="footer-inner">
Â  Â  Â  <strong>Editora CrÃ¡s â€¢ </strong>
Â  Â  Â  <a href="mailto:contato@editoracras.com">Suporte</a>
Â  Â  Â  <small>Â© 2025. Todos os direitos reservados.</small>
Â  Â  </div>
Â  </footer>

Â  <script>
Â  Â  const API_URL = "https://script.google.com/macros/s/AKfycbwQ9utyV79uWjpVHuBRWbie_2kkgTX-lPBudob49WA2daqn5qdbdqyzhl3LqYC0y_fVuQ/exec";
Â  Â  const MAX_FILES = 3;
Â  Â  let sessao = null, bootstrap = null;
Â  Â  const qs = s => document.querySelector(s);
Â  Â  const qsa = s => Array.from(document.querySelectorAll(s));
Â  Â  const show = el => el.classList.remove('hidden');
Â  Â  const hide = el => el.classList.add('hidden');
Â  Â  function setLoading(state){qs("#overlay").style.display=state?"grid":"none";const b=qs("#btnEnviar");if(b)b.disabled=state;}

    // NOVO: FunÃ§Ã£o para mostrar a notificaÃ§Ã£o (Snack/Toastbar)
    function showSnackbar(message) {
        const snack = qs("#snackbar");
        snack.textContent = message;
        snack.className = "show";
        setTimeout(function(){ snack.className = snack.className.replace("show", ""); }, 3000);
    }
    function validEmail(v){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v); }

Â  Â  document.addEventListener("DOMContentLoaded", async () => {
Â  Â  Â  try{ sessao=JSON.parse(localStorage.getItem("sessao_portal")||"null"); }catch{}
Â  Â  Â  const params=new URLSearchParams(location.search);
Â  Â  Â  if(!sessao) sessao={email:params.get("email"),curso:params.get("curso")};
Â  Â  Â  // TROCA: alert por showSnackbar
Â  Â  Â  if(!sessao||!validEmail(sessao.email)||!sessao.curso){showSnackbar("FaÃ§a login novamente.");location.href="index.html";return;}

Â  Â  Â  await carregarBootstrap(sessao.curso,sessao.email);
Â  Â  Â  qs("#btnAbrirEnvio").onclick=abrirEnvio;
Â  Â  Â  qs("#btnVoltarEnvio").onclick=()=>{hide(qs("#envio"));show(qs("#dashboard"));window.scrollTo({top:0,behavior:"smooth"});}
Â  Â  Â  qs("#btnAddImagem").onclick=addFileInput;
Â  Â  Â  qs("#btnResetar").onclick=resetFiles;
Â  Â  Â  qs("#btnEnviar").onclick=enviarExercicio;
Â  Â  Â  qs("#btnVoltarMenu").onclick=()=>{hide(qs("#sucesso"));show(qs("#dashboard"));};
Â  Â  Â  qs("#btnSair").onclick=()=>{localStorage.removeItem("sessao_portal");location.href="index.html";};
Â  Â  Â  updateAddBtnVisibility();
Â  Â  });

Â  Â  async function carregarBootstrap(curso,email){
Â  Â  Â  try{
Â  Â  Â  Â  const r=await fetch(`${API_URL}?action=portalBootstrap&curso=${encodeURIComponent(curso)}&email=${encodeURIComponent(email)}`);
Â  Â  Â  Â  bootstrap=await r.json(); if(!bootstrap||bootstrap.allowed!==true){location.href="index.html";return;}
Â  Â  Â  Â  qs(".topbar").textContent=`[${bootstrap.nome||"aluno"}]`;
Â  Â  Â  Â  const logo=qs("#cursoLogo"); if(bootstrap.logoUrl){logo.src=bootstrap.logoUrl;logo.style.display="block";}

Â  Â  Â  Â  const dr = +bootstrap.diasRestantes || 0;
if (dr > 0) {
Â  const txt = dr === 1
Â  Â  ? `[${dr}] dia restante de acesso ao curso.`
Â  Â  : `[${dr}] dias restantes de acesso ao curso.`;
Â  qs("#diasRestantes").textContent = txt;
} else {
Â  qs("#diasRestantes").textContent = "Acesso expirado.";
}
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(dr<=30&&bootstrap.desconto?.cupom){qs("#cupomBox").style.display="block";qs("#cupomCod").textContent=bootstrap.desconto.cupom;qs("#cupomPerc").textContent=bootstrap.desconto.porcentagem;qs("#cupomLink").href=bootstrap.desconto.link;}

Â  Â  Â  Â  const fb=bootstrap.feedback||{};
Â  Â  Â  Â  if(fb.dia){qs("#fbDiaTxt").textContent=fb.dia;qs("#fbDiaTxt").style.display="block";}
Â  Â  Â  Â  if(fb.hora){qs("#fbHoraTxt").textContent=fb.hora;qs("#fbHoraTxt").style.display="block";}
Â  Â  Â  Â  qs("#fbProf").textContent=bootstrap.feedback?.professor || "â€”";
Â  Â  Â  Â  qs("#fbSenha").textContent=fb.senha||"â€”";
Â  Â  Â  Â  qs("#fbInfo").textContent=fb.info||"â€”";
Â  Â  Â  Â  if(fb.link){qs("#fbLink").href=fb.link;qs("#fbLink").textContent=fb.link;}
Â  Â  Â  Â  if(fb.aulaGravada){qs("#ultimaGravada").href=fb.aulaGravada;qs("#ultimaGravada").textContent=fb.aulaGravada;}
Â  Â  Â  }catch(e){showSnackbar("Erro ao carregar. FaÃ§a login novamente.");location.href="index.html";} // TROCA
Â  Â  }

Â  Â  async function abrirEnvio(){hide(qs("#dashboard"));await carregarModulos();show(qs("#envio"));window.scrollTo({top:0,behavior:"smooth"});}
Â  Â  async function carregarModulos(){
Â  Â  Â  const sel=qs("#selModulo"),selA=qs("#selAula");
Â  Â  Â  sel.disabled=true;sel.innerHTML="<option>Carregando...</option>";
Â  Â  Â  selA.disabled=true;selA.innerHTML="<option>Selecione o mÃ³dulo primeiro</option>";
Â  Â  Â  try{
Â  Â  Â  Â  const r=await fetch(`${API_URL}?action=listModules&curso=${encodeURIComponent(sessao.curso)}`);
Â  Â  Â  Â  const d=await r.json(); const mods=Array.isArray(d.modulos)?d.modulos:[];
Â  Â  Â  Â  sel.innerHTML="<option value=''>Selecione o mÃ³dulo</option>";
Â  Â  Â  Â  mods.forEach(m=>{const o=document.createElement("option");o.value=m;o.textContent=m;sel.appendChild(o);});
Â  Â  Â  Â  sel.disabled=false; sel.onchange=carregarAulas;
Â  Â  Â  }catch{sel.innerHTML="<option>Erro ao carregar mÃ³dulos</option>";showSnackbar("Falha ao carregar mÃ³dulos.");} // TROCA
Â  Â  }
Â  Â  async function carregarAulas(){
Â  Â  Â  const modulo=qs("#selModulo").value,sel=qs("#selAula");
Â  Â  Â  if(!modulo){sel.innerHTML="<option>Selecione o mÃ³dulo primeiro</option>";return;}
Â  Â  Â  sel.innerHTML="<option>Carregando aulas...</option>";
Â  Â  Â  try{
Â  Â  Â  Â  const r=await fetch(`${API_URL}?action=listLessons&curso=${encodeURIComponent(sessao.curso)}&modulo=${encodeURIComponent(modulo)}`);
Â  Â  Â  Â  const d=await r.json(); const aulas=Array.isArray(d.aulas)?d.aulas:[];
Â  Â  Â  Â  sel.innerHTML="<option value=''>Selecione a aula</option>";
Â  Â  Â  Â  aulas.forEach(a=>{const o=document.createElement("option");o.value=a;o.textContent=a;sel.appendChild(o);});
Â  Â  Â  Â  sel.disabled=false;
Â  Â  Â  }catch{sel.innerHTML="<option>Erro ao carregar aulas</option>";showSnackbar("Falha ao carregar aulas.");} // TROCA
Â  Â  }

Â  Â  function addFileInput(){
Â  Â  Â  const wrap=qs("#filesWrap"); const count=qsa("#filesWrap input[type='file']").length;
Â  Â  Â  // TROCA: alert por showSnackbar
Â  Â  Â  if(count>=MAX_FILES)return showSnackbar(`MÃ¡ximo de ${MAX_FILES} imagens.`);
Â  Â  Â  const inp=document.createElement("input");inp.type="file";inp.accept="image/*";inp.className="fileItem";
Â  Â  Â  wrap.insertBefore(inp,wrap.lastElementChild);
Â  Â  Â  updateAddBtnVisibility();
Â  Â  }

Â  Â  function resetFiles(){
Â  Â  Â  qs("#filesWrap").innerHTML='<input type="file" class="fileItem" accept="image/*"><div class="thumb-hint">Formatos JPG/PNG. AtÃ© 3 envios.</div>';
Â  Â  Â  updateAddBtnVisibility();
Â  Â  }

Â  Â  function updateAddBtnVisibility(){
Â  Â  Â  const count=qsa("#filesWrap input[type='file']").length;
Â  Â  Â  qs("#btnAddImagem").style.display=count>=MAX_FILES?"none":"inline-block";
Â  Â  }

Â  Â  async function enviarExercicio(){
Â  Â  Â  const modulo=qs("#selModulo").value.trim(),aula=qs("#selAula").value.trim(),desc=qs("#descricao").value.trim();
Â  Â  Â  // TROCA: alert por showSnackbar
Â  Â  Â  if(!modulo)return showSnackbar("Selecione o mÃ³dulo.");
Â  Â  Â  if(!aula)return showSnackbar("Selecione a aula.");
Â  Â  Â  
Â  Â  Â  const chosen=qsa("#filesWrap input[type='file']").map(i=>i.files[0]).filter(Boolean);
Â  Â  Â  // TROCA: alert por showSnackbar
Â  Â  Â  if(!chosen.length)return showSnackbar("Envie pelo menos uma imagem.");
Â  Â  Â  if(chosen.length>MAX_FILES)return showSnackbar(`MÃ¡ximo de ${MAX_FILES} imagens.`);
Â  Â  Â  
Â  Â  Â  setLoading(true);
Â  Â  Â  
Â  Â  Â  try{
Â  Â  Â  Â  const files=[];
Â  Â  Â  Â  for(const f of chosen){
Â  Â  Â  Â  Â  const base64=await new Promise((res,rej)=>{const fr=new FileReader();fr.onload=()=>res(fr.result.split(",")[1]);fr.onerror=()=>rej();fr.readAsDataURL(f);});
Â  Â  Â  Â  Â  files.push({name:f.name,type:f.type,content:base64});
Â  Â  Â  Â  }
Â  Â  Â  Â  const body={action:"uploadExercise",curso:sessao.curso,email:sessao.email,nome:bootstrap.nome,modulo,aula,descricao:desc,files};
Â  Â  Â  Â  const r=await fetch(API_URL,{method:"POST",body:JSON.stringify(body)});const d=await r.json();
Â  Â  Â  Â  if(!d.ok)throw new Error(d.message||"Falha");
Â  Â  Â  Â  hide(qs("#envio"));show(qs("#sucesso"));
        setTimeout(()=>showSnackbar('ExercÃ­cio enviado com sucesso! Aguarde o feedback do professor.'), 50); // NOVO: Snackbar de sucesso
Â  Â  Â  }catch(e){showSnackbar("Erro: "+e.message);}finally{setLoading(false);} // TROCA
Â  Â  }
Â  </script>
</body>
</html>
